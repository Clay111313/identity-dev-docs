---
permalink: /oidc/authorization

endpoint: /openid_connect/authorize
order: 2

summary: Starts the authorization flow
---


## Authorization

The authorization endpoint handles authentication and authorization of a user. To present the login.gov authorization page to a user, direct them to the `/openid_connect/authorize`.


{% capture private_key_jwt %}
```bash
https://idp.int.identitysandbox.gov/openid_connect/authorize?
  acr_values=http%3A%2F%2Fidmanagement.gov%2Fns%2Fassurance%2Fial%2F1&
  client_id=${CLIENT_ID}&
  nonce=${NONCE}&
  prompt=select_account&
  redirect_uri=${REDIRECT_URI}&
  response_type=code&
  scope=openid+email&
  state=abcdefghijklmnopabcdefghijklmnop
```
{% endcapture %}

{% capture pkce %}
```bash
https://idp.int.identitysandbox.gov/openid_connect/authorize?
  acr_values=http%3A%2F%2Fidmanagement.gov%2Fns%2Fassurance%2Fial%2F1&
  client_id=${CLIENT_ID}&
  code_challenge=${CODE_CHALLENGE}&
  code_challenge_method=S256&
  nonce=${NONCE}&
  prompt=select_account&
  redirect_uri=${REDIRECT_URI}&
  response_type=code&
  scope=openid+email&
  state=abcdefghijklmnopabcdefghijklmnop
```
{% endcapture %}

{% include two_examples.html example_one=private_key_jwt
                             example_one_title="private_key_jwt"
                             example_two=pkce
                             example_two_title="PKCE" %}

### Request Parameters

* **[acr_values](#acr_values)**
* **[client_id](#client_id)**
* **[code_challenge](#code_challenge)** — *required for PKCE*
* **[code_challenge_method](#code_challenge_method)** -- *required for PKCE*
* **[nonce](#nonce)**
* **[prompt](#prompt)** -- *optional, requires administrator approval*
* **[redirect_uri](#redirect_uri)**
* **[response_type](#response_type)**
* **[scope](#scope)**
* **[state](#state)**
* **[verified_within](#verified_within)** -- *optional, only applies to IAL2*


### acr_values

The Authentication Context Class Reference requests can be used to specify the IAL (Identity Assurance Level) or the AAL (Authentication Assurance Level) for the user. These and the `scope` determine which [user attributes]({{ site.baseurl }}/attributes/) will be available in the [user info response](#user-info-response).

Multiple values can be joined with a space (before being URI-escaped in the final URL)

#### IAL Values
An IAL value must be specified.

  - **`http://idmanagement.gov/ns/assurance/ial/1`**
      Basic identity assurance, does not require identity verification (this is the most common value).
  - **`http://idmanagement.gov/ns/assurance/ial/2`**
      Requires that the user has gone through identity verification
  - **`http://idmanagement.gov/ns/assurance/ial/2?strict=true`**
      Requires that the user has gone through identity verification, including a "liveness" check  (this is not available in production, only in int and staging environments)


#### AAL Values
We default to requiring a user to be authenticated with a second factor:

- **`urn:gov:gsa:ac:classes:sp:PasswordProtectedTransport:duo`**
    This specifies that a user has been authenticated with a second factor. This value will be returned in the user attributes by default. We do not allow AAL 1, because it implies that a user did not authenticate with a second factor.

Stricter behavior can be specified by adding one of:

  - **`http://idmanagement.gov/ns/assurance/aal/3`**
      This specifies that a user has been authenticated with a crytographically secure method, such as WebAuthn or using a PIV/CAC.
  - **`http://idmanagement.gov/ns/assurance/aal/3?hspd12=true`**
      This specifies that a user has been authenticated with an HSPD12 credential (requires PIV/CAC)

#### LOA Values
These not recommended, they are for legacy compatibility only.
  - **`http://idmanagement.gov/ns/assurance/loa/1`**
    Equivalent to IAL1
  - **`http://idmanagement.gov/ns/assurance/loa/3`**
    Equivalent to IAL2

### client_id

The unique identifier for the client. This will be registered with the login.gov IdP in advance.

### code_challenge
— *required for PKCE*
The URL-safe base64 encoding of the SHA256 digest of a random value generated by the client. The original random value is referred to as the `code_verifier` and is later used with the token endpoint. Generating these values in Ruby might look like this, for example:
```ruby
code_verifier = SecureRandom.hex
=> "7a5e819dd39f17242fdeeba0c1c80be6"
code_challenge = Digest::SHA256.base64digest(code_verifier)
=> "TdzfmaWefbtaI0Wdo6lrZCXpLu1WpamnSoSHfDUiL7Y="
```

### code_challenge_method
-- *required for PKCE*
This must be `S256`, the only PKCE code challenge method supported.

### prompt
-- *optional, requires administrator approval*
To force a re-authorization event when a current IdP session is active, you will need to set the `prompt` attribute to `login`, like this: `prompt=login`.  

Request permission for your application to do this by emailing an administrator at <partners@login.gov>.

**User experience**

If prompt is not specified and the user has an active IdP session, they are given the choice to continue authenticating or login with another account.

### response_type

This must be `code`.

### redirect_uri

The URI login.gov will redirect to after a successful authorization.

### scope

A space-separated string of the scopes being requested. The authorization page will display the list of attributes being requested from the user. Applications should aim to request the fewest [user attributes]({{ site.baseurl }}/attributes/) and smallest scope needed. Possible values are:
 - `openid`
 - `address`
 - `email`
 - `phone`
 - `profile:birthdate`
 - `profile:name`
 - `profile:verified_at`
 - `profile`
 - `social_security_number`

### state

A unique value at least 22 characters in length used for maintaining state between the request and the callback. This value will be returned to the client on a successful authorization.

### nonce

A unique value at least 22 characters in length used to verify the integrity of the `id_token` and mitigate [replay attacks](https://en.wikipedia.org/wiki/Replay_attack). This value should include per-session state and be unguessable by attackers. This value will be present in the `id_token` of the [token endpoint response](#token-response), where clients will verify that the nonce claim value is equal to the value of the nonce parameter sent in the authentication request. Read more about [nonce implementation](http://openid.net/specs/openid-connect-core-1_0.html#NonceNotes) in the spec.

### verified_within
-- *optional, only applies to IAL2*
Specifies how recently the user's IAL2 information must be verified. For example, if your application requires that the user's data must have been verified within the last year, you can set the value to `verified_within=1y`, and customers whose data is older than that will go through the identity proofing process again before continuing back to your application.

<details markdown="1">
  <summary>Possible values</summary>

The shortest value allowed for this parameter is 30 days (`30d`) because of the cost of proofing, as well as the time it takes for backend proofing sources to be updated.

The format for this value is **`xD`**, where **`x`** is an integer number and **`D`** specifies the duration. **`D`** can be:
  * `d` for number of days
    * Example: `45d`
  * `w` for a number of weeks
    * Example: `8w` (equivalent to `56d`)
  * `m` for a number of months (assumed to be 30-day months)
    * Example: `18m` (equivalent to `540d`)
  * `y` for a number of years (assumed to be 365-day years)
    * Example: `2y` (equivalent to `730d`)
</details>


### Authorization response

After an authorization, login.gov will redirect to the provided `redirect_uri`.

In a **successful authorization**, the URI will contain the two parameters `code` and `state`:

- **code** — A unique authorization code the client can pass to the [token endpoint](#token).
- **state** — The `state` value originally provided by the client.

For example:

```bash
https://agency.gov/response?
  code=12345&
  state=abcdefghijklmnopabcdefghijklmnop
```

In an **unsuccessful authorization**, the URI will contain the parameters `error` and `state`, and optionally `error_description`:

- **error** — The error type, either:
  - `access_denied` — The user has either cancelled or declined to authorize the client.
  - `invalid_request` — The authorization request was invalid. See the `error_description` parameter for more details.
- **error_description** — A description of the error.
- **state** — The `state` value originally provided by the client.

For example:

```bash
https://agency.gov/response?
  error=access_denied&
  state=abcdefghijklmnopabcdefghijklmnop
```
